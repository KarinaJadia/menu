<!DOCTYPE html>
<html lang="en">
<body>
  <h2>select a dining hall</h2>

  <button onclick="getMenu('Connecticut')">Connecticut</button>
  <button onclick="getMenu('North')">North</button>
  <button onclick="getMenu('Putnam')">Putnam</button>
  <button onclick="getMenu('Towers')">Towers</button>
  <button onclick="getMenu('Northwest')">Northwest</button>
  <button onclick="getMenu('Whitney')">Whitney</button>
  <button onclick="getMenu('McMahon')">McMahon</button>
  <button onclick="getMenu('South')">South</button>

  <p id="output"></p>

  <script>
    function getMenu(location) {
        const options = {
            'Connecticut': '03', 'North': '07', 'Putnam': '06',
            'Towers': '42', 'Northwest': '15', 'Whitney': '01',
            'McMahon': '05', 'South': '16'
        };

        const locNum = options[location];
        const meals = ['Breakfast', 'Lunch', 'Dinner'];
        const output = document.getElementById('output');
        output.textContent = `loading ${location} menu...`;

        Promise.all(meals.map(meal => {
        const url = `https://nutritionanalysis.dds.uconn.edu/longmenu.aspx?sName=UCONN+Dining+Services&locationNum=${locNum}&naFlag=1&WeeksMenus=This+Week%27s+Menus&mealName=${meal}`;
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;

        return fetch(proxyUrl)
            .then(response => {
                if (!response.ok) throw new Error("Network response was not ok.");
                return response.json();
            })
            .then(data => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(data.contents, 'text/html');
                const items = Array.from(doc.querySelectorAll('div.longmenucoldispname a')).map(a => a.textContent.trim());
                return { meal, items };
            });
        }))
        .then(results => {
        output.innerHTML = `<h3>${location.toLowerCase()} menu</h3>` + results.map(({ meal, items }) =>
            `<strong>${meal}</strong><br>${items.join('<br>') || 'no items found'}<br><br>`
        ).join('');
        })
        .catch(error => {
            output.textContent = 'Error fetching menu: ' + error.message;
        });
    }
  </script>
</body>
</html>